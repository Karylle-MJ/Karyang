<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Galactic Defender</title>
<style>
    body {
        margin: 0;
        overflow: hidden;
        background-color: #000;
        font-family: Arial, sans-serif;
    }
    
    #game-container {
        position: relative;
        width: 100vw;
        height: 100vh;
    }
    
    #game-canvas {
        display: block;
        background-color: #000;
    }
    
    #hud {
        position: absolute;
        top: 10px;
        left: 10px;
        color: white;
        font-size: 18px;
    }
    
    #controls {
        position: absolute;
        bottom: 10px;
        left: 10px;
        color: #aaa;
        font-size: 14px;
    }

    /* Game Over Popup */
    #game-over-popup {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.85);
        color: white;
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        z-index: 1000;
    }
    #game-over-popup h1 {
        font-size: 48px;
        margin-bottom: 20px;
    }
    #game-over-popup p {
        font-size: 20px;
        margin-bottom: 15px;
    }
    #restart-btn {
        background: #00FFAA;
        color: black;
        border: none;
        padding: 12px 24px;
        font-size: 18px;
        cursor: pointer;
        border-radius: 8px;
        transition: background 0.3s;
        margin-top: 20px;
    }
    #restart-btn:hover {
        background: #00cc88;
    }

    #top-scores-list {
        list-style: none;
        padding: 0;
        margin: 0;
        font-size: 18px;
        max-width: 200px;
        text-align: left;
    }
   #top-scores-list li {
    display: flex;
    justify-content: space-between;
    border-bottom: 1px solid #00FFAA;
    padding-bottom: 3px;
    margin-bottom: 5px;
    font-weight: bold;
    }

    #top-scores-list li span:first-child {
    padding-right: 10px;
    border-right: 2px solid #00FFAA;
    margin-right: 10px;
    }


</style>
</head>
<body>
<div id="game-container">
    <canvas id="game-canvas"></canvas>
    <div id="hud">
        Score: <span id="score">0</span> | 
        Power: <span id="power">Normal</span> | 
        Highest Score: <span id="high-score">0</span>
    </div>
    <div id="controls">
        <p><strong>WASD</strong> - Move | <strong>Mouse</strong> - Aim & Shoot</p>
    </div>

    <!-- Game Over Popup -->
    <div id="game-over-popup">
        <h1>Game Over</h1>
        <p>Your Score: <span id="final-score">0</span></p>
        <p>Top 5 Highest Scores:</p>
        <ul id="top-scores-list"></ul>
        <button id="restart-btn">Restart</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('game-canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let gameRunning = true;

    let player = {
        x: canvas.width / 2,
        y: canvas.height / 2,
        radius: 20,
        speed: 5,
        color: '#00FFAA',
        bullets: [],
        lastShot: 0,
        fireRate: 300,
        power: "Normal"
    };

    let enemies = [];
    let score = 0;
    let powerUps = [];
    const powerTypes = ["Rapid Fire", "Speed Boost"];

    const keys = { w: false, a: false, s: false, d: false };
    const mouse = { x: 0, y: 0, click: false };

    const gameOverPopup = document.getElementById("game-over-popup");
    const finalScoreText = document.getElementById("final-score");
    const restartBtn = document.getElementById("restart-btn");
    const topScoresList = document.getElementById("top-scores-list");

    // Retrieve top 5 scores from localStorage or initialize
    let topScores = JSON.parse(localStorage.getItem('galacticDefenderTopScores')) || [0,0,0,0,0];

    // Show the highest score in HUD (top of the topScores list)
    document.getElementById('high-score').textContent = Math.max(...topScores);

    restartBtn.addEventListener("click", () => {
        gameOverPopup.style.display = "none";
        resetGame();
    });

    window.addEventListener('keydown', (e) => {
        if (e.key.toLowerCase() in keys) keys[e.key.toLowerCase()] = true;
    });

    window.addEventListener('keyup', (e) => {
        if (e.key.toLowerCase() in keys) keys[e.key.toLowerCase()] = false;
    });

    canvas.addEventListener('mousemove', (e) => {
        const rect = canvas.getBoundingClientRect();
        mouse.x = e.clientX - rect.left;
        mouse.y = e.clientY - rect.top;
    });

    canvas.addEventListener('mousedown', () => { mouse.click = true; });
    canvas.addEventListener('mouseup', () => { mouse.click = false; });

    function resetGame() {
        player = {
            x: canvas.width / 2,
            y: canvas.height / 2,
            radius: 20,
            speed: 5,
            color: '#00FFAA',
            bullets: [],
            lastShot: 0,
            fireRate: 300,
            power: "Normal"
        };
        enemies = [];
        powerUps = [];
        score = 0;
        document.getElementById('score').textContent = score;
        document.getElementById('power').textContent = "Normal";
        mouse.click = false;
        gameRunning = true;
        gameLoop();
    }

    function spawnEnemy() {
        const side = Math.floor(Math.random() * 4);
        let x, y;
        if (side === 0) { x = Math.random() * canvas.width; y = -30; }
        else if (side === 1) { x = canvas.width + 30; y = Math.random() * canvas.height; }
        else if (side === 2) { x = Math.random() * canvas.width; y = canvas.height + 30; }
        else { x = -30; y = Math.random() * canvas.height; }
        enemies.push({
            x, 
            y,
            radius: 15,
            speed: 1 + Math.random() * 2,
            color: `hsl(${Math.random() * 360}, 70%, 50%)`
        });
    }

    function spawnPowerUp() {
        if (Math.random() < 0.02) {
            powerUps.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                radius: 10,
                type: powerTypes[Math.floor(Math.random() * powerTypes.length)],
                color: '#FFFF00'
            });
        }
    }

    function updatePlayer() {
        if (keys.w && player.y > player.radius) player.y -= player.speed;
        if (keys.a && player.x > player.radius) player.x -= player.speed;
        if (keys.s && player.y < canvas.height - player.radius) player.y += player.speed;
        if (keys.d && player.x < canvas.width - player.radius) player.x += player.speed;
    }

    function shoot() {
        const now = Date.now();
        if (mouse.click && now - player.lastShot > player.fireRate) {
            const angle = Math.atan2(mouse.y - player.y, mouse.x - player.x);
            const speed = 10;
            player.bullets.push({
                x: player.x,
                y: player.y,
                radius: 5,
                speedX: Math.cos(angle) * speed,
                speedY: Math.sin(angle) * speed,
                color: '#FF5555'
            });
            player.lastShot = now;
        }
    }

    function updateBullets() {
        for (let i = player.bullets.length - 1; i >= 0; i--) {
            const bullet = player.bullets[i];
            bullet.x += bullet.speedX;
            bullet.y += bullet.speedY;
            if (bullet.x < 0 || bullet.x > canvas.width || bullet.y < 0 || bullet.y > canvas.height) {
                player.bullets.splice(i, 1);
            }
        }
    }

    function updateEnemies() {
        for (let i = enemies.length - 1; i >= 0; i--) {
            const enemy = enemies[i];
            const angle = Math.atan2(player.y - enemy.y, player.x - enemy.x);
            enemy.x += Math.cos(angle) * enemy.speed;
            enemy.y += Math.sin(angle) * enemy.speed;

            const distance = Math.sqrt((player.x - enemy.x) ** 2 + (player.y - enemy.y) ** 2);
            if (distance < player.radius + enemy.radius) {
                gameRunning = false;
                finalScoreText.textContent = score;

                // Insert current score into topScores array and sort descending
                topScores.push(score);
                topScores.sort((a,b) => b - a);
                topScores = topScores.slice(0,5); // keep top 5 only
                localStorage.setItem('galacticDefenderTopScores', JSON.stringify(topScores));

                // Update HUD highest score
                document.getElementById('high-score').textContent = topScores[0];

                // Display top 5 scores list in popup
                renderTopScores();

                gameOverPopup.style.display = "flex";
                return;
            }

            for (let j = player.bullets.length - 1; j >= 0; j--) {
                const bullet = player.bullets[j];
                const bulletDistance = Math.sqrt((bullet.x - enemy.x) ** 2 + (bullet.y - enemy.y) ** 2);
                if (bulletDistance < enemy.radius + bullet.radius) {
                    player.bullets.splice(j, 1);
                    enemies.splice(i, 1);
                    score += 10;
                    document.getElementById('score').textContent = score;
                    break;
                }
            }
        }
    }

    function updatePowerUps() {
        for (let i = powerUps.length - 1; i >= 0; i--) {
            const powerUp = powerUps[i];
            const distance = Math.sqrt((player.x - powerUp.x) ** 2 + (player.y - powerUp.y) ** 2);
            if (distance < player.radius + powerUp.radius) {
                player.power = powerUp.type;
                document.getElementById('power').textContent = powerUp.type;
                if (powerUp.type === "Rapid Fire") {
                    player.fireRate = 100;
                    setTimeout(() => {
                        player.fireRate = 300;
                        player.power = "Normal";
                        document.getElementById('power').textContent = "Normal";
                    }, 5000);
                } else if (powerUp.type === "Speed Boost") {
                    player.speed = 10;
                    setTimeout(() => {
                        player.speed = 5;
                        player.power = "Normal";
                        document.getElementById('power').textContent = "Normal";
                    }, 5000);
                }
                powerUps.splice(i, 1);
            }
        }
    }

    function draw() {
        ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.fillStyle = player.color;
        ctx.beginPath();
        ctx.arc(player.x, player.y, player.radius, 0, Math.PI * 2);
        ctx.fill();

        for (const bullet of player.bullets) {
            ctx.fillStyle = bullet.color;
            ctx.beginPath();
            ctx.arc(bullet.x, bullet.y, bullet.radius, 0, Math.PI * 2);
            ctx.fill();
        }

        for (const enemy of enemies) {
            ctx.fillStyle = enemy.color;
            ctx.beginPath();
            ctx.arc(enemy.x, enemy.y, enemy.radius, 0, Math.PI * 2);
            ctx.fill();
        }

        for (const powerUp of powerUps) {
            ctx.fillStyle = powerUp.color;
            ctx.beginPath();
            ctx.arc(powerUp.x, powerUp.y, powerUp.radius, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = '#000';
            ctx.font = '10px Arial';
            ctx.fillText(powerUp.type[0], powerUp.x - 3, powerUp.y + 3);
        }

        ctx.strokeStyle = '#FFF';
        ctx.beginPath();
        ctx.moveTo(mouse.x - 10, mouse.y);
        ctx.lineTo(mouse.x + 10, mouse.y);
        ctx.moveTo(mouse.x, mouse.y - 10);
        ctx.lineTo(mouse.x, mouse.y + 10);
        ctx.stroke();
    }

    function renderTopScores() {
    const labels = ["First", "Second", "Third", "Fourth", "Fifth"];
    topScoresList.innerHTML = '';
    topScores.forEach((score, index) => {
        const li = document.createElement('li');
        const placeSpan = document.createElement('span');
        placeSpan.textContent = labels[index];
        
        const scoreSpan = document.createElement('span');
        scoreSpan.textContent = score;
        
        li.appendChild(placeSpan);
        li.appendChild(scoreSpan);
        topScoresList.appendChild(li);
    });
    }


    function gameLoop() {
        if (!gameRunning) return;
        updatePlayer();
        shoot();
        updateBullets();
        updateEnemies();
        spawnPowerUp();
        updatePowerUps();
        if (Math.random() < 0.02) spawnEnemy();
        draw();
        requestAnimationFrame(gameLoop);
    }

    gameLoop();
</script>
</body>
</html>
